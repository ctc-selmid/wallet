{"ast":null,"code":"var aes=require(\"./aes\");var Buffer=require('safe-buffer').Buffer;var Transform=require('cipher-base');var inherits=require('inherits');var GHASH=require(\"./ghash\");var xor=require('buffer-xor');var incr32=require(\"./incr32\");function xorTest(a,b){var out=0;if(a.length!==b.length)out++;var len=Math.min(a.length,b.length);for(var i=0;i<len;++i){out+=a[i]^b[i];}return out;}function calcIv(self,iv,ck){if(iv.length===12){self._finID=Buffer.concat([iv,Buffer.from([0,0,0,1])]);return Buffer.concat([iv,Buffer.from([0,0,0,2])]);}var ghash=new GHASH(ck);var len=iv.length;var toPad=len%16;ghash.update(iv);if(toPad){toPad=16-toPad;ghash.update(Buffer.alloc(toPad,0));}ghash.update(Buffer.alloc(8,0));var ivBits=len*8;var tail=Buffer.alloc(8);tail.writeUIntBE(ivBits,0,8);ghash.update(tail);self._finID=ghash.state;var out=Buffer.from(self._finID);incr32(out);return out;}function StreamCipher(mode,key,iv,decrypt){Transform.call(this);var h=Buffer.alloc(4,0);this._cipher=new aes.AES(key);var ck=this._cipher.encryptBlock(h);this._ghash=new GHASH(ck);iv=calcIv(this,iv,ck);this._prev=Buffer.from(iv);this._cache=Buffer.allocUnsafe(0);this._secCache=Buffer.allocUnsafe(0);this._decrypt=decrypt;this._alen=0;this._len=0;this._mode=mode;this._authTag=null;this._called=false;}inherits(StreamCipher,Transform);StreamCipher.prototype._update=function(chunk){if(!this._called&&this._alen){var rump=16-this._alen%16;if(rump<16){rump=Buffer.alloc(rump,0);this._ghash.update(rump);}}this._called=true;var out=this._mode.encrypt(this,chunk);if(this._decrypt){this._ghash.update(chunk);}else{this._ghash.update(out);}this._len+=chunk.length;return out;};StreamCipher.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error('Unsupported state or unable to authenticate data');var tag=xor(this._ghash.final(this._alen*8,this._len*8),this._cipher.encryptBlock(this._finID));if(this._decrypt&&xorTest(tag,this._authTag))throw new Error('Unsupported state or unable to authenticate data');this._authTag=tag;this._cipher.scrub();};StreamCipher.prototype.getAuthTag=function getAuthTag(){if(this._decrypt||!Buffer.isBuffer(this._authTag))throw new Error('Attempting to get auth tag in unsupported state');return this._authTag;};StreamCipher.prototype.setAuthTag=function setAuthTag(tag){if(!this._decrypt)throw new Error('Attempting to set auth tag in unsupported state');this._authTag=tag;};StreamCipher.prototype.setAAD=function setAAD(buf){if(this._called)throw new Error('Attempting to set AAD in unsupported state');this._ghash.update(buf);this._alen+=buf.length;};module.exports=StreamCipher;","map":{"version":3,"sources":["/Users/naohirofujie/.anyenv/envs/nodenv/versions/14.5.0/lib/node_modules/expo-cli/node_modules/browserify-aes/authCipher.js"],"names":["aes","require","Buffer","Transform","inherits","GHASH","xor","incr32","xorTest","a","b","out","length","len","Math","min","i","calcIv","self","iv","ck","_finID","concat","from","ghash","toPad","update","alloc","ivBits","tail","writeUIntBE","state","StreamCipher","mode","key","decrypt","call","h","_cipher","AES","encryptBlock","_ghash","_prev","_cache","allocUnsafe","_secCache","_decrypt","_alen","_len","_mode","_authTag","_called","prototype","_update","chunk","rump","encrypt","_final","Error","tag","final","scrub","getAuthTag","isBuffer","setAuthTag","setAAD","buf","module","exports"],"mappings":"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","sourcesContent":["var aes = require('./aes')\nvar Buffer = require('safe-buffer').Buffer\nvar Transform = require('cipher-base')\nvar inherits = require('inherits')\nvar GHASH = require('./ghash')\nvar xor = require('buffer-xor')\nvar incr32 = require('./incr32')\n\nfunction xorTest (a, b) {\n  var out = 0\n  if (a.length !== b.length) out++\n\n  var len = Math.min(a.length, b.length)\n  for (var i = 0; i < len; ++i) {\n    out += (a[i] ^ b[i])\n  }\n\n  return out\n}\n\nfunction calcIv (self, iv, ck) {\n  if (iv.length === 12) {\n    self._finID = Buffer.concat([iv, Buffer.from([0, 0, 0, 1])])\n    return Buffer.concat([iv, Buffer.from([0, 0, 0, 2])])\n  }\n  var ghash = new GHASH(ck)\n  var len = iv.length\n  var toPad = len % 16\n  ghash.update(iv)\n  if (toPad) {\n    toPad = 16 - toPad\n    ghash.update(Buffer.alloc(toPad, 0))\n  }\n  ghash.update(Buffer.alloc(8, 0))\n  var ivBits = len * 8\n  var tail = Buffer.alloc(8)\n  tail.writeUIntBE(ivBits, 0, 8)\n  ghash.update(tail)\n  self._finID = ghash.state\n  var out = Buffer.from(self._finID)\n  incr32(out)\n  return out\n}\nfunction StreamCipher (mode, key, iv, decrypt) {\n  Transform.call(this)\n\n  var h = Buffer.alloc(4, 0)\n\n  this._cipher = new aes.AES(key)\n  var ck = this._cipher.encryptBlock(h)\n  this._ghash = new GHASH(ck)\n  iv = calcIv(this, iv, ck)\n\n  this._prev = Buffer.from(iv)\n  this._cache = Buffer.allocUnsafe(0)\n  this._secCache = Buffer.allocUnsafe(0)\n  this._decrypt = decrypt\n  this._alen = 0\n  this._len = 0\n  this._mode = mode\n\n  this._authTag = null\n  this._called = false\n}\n\ninherits(StreamCipher, Transform)\n\nStreamCipher.prototype._update = function (chunk) {\n  if (!this._called && this._alen) {\n    var rump = 16 - (this._alen % 16)\n    if (rump < 16) {\n      rump = Buffer.alloc(rump, 0)\n      this._ghash.update(rump)\n    }\n  }\n\n  this._called = true\n  var out = this._mode.encrypt(this, chunk)\n  if (this._decrypt) {\n    this._ghash.update(chunk)\n  } else {\n    this._ghash.update(out)\n  }\n  this._len += chunk.length\n  return out\n}\n\nStreamCipher.prototype._final = function () {\n  if (this._decrypt && !this._authTag) throw new Error('Unsupported state or unable to authenticate data')\n\n  var tag = xor(this._ghash.final(this._alen * 8, this._len * 8), this._cipher.encryptBlock(this._finID))\n  if (this._decrypt && xorTest(tag, this._authTag)) throw new Error('Unsupported state or unable to authenticate data')\n\n  this._authTag = tag\n  this._cipher.scrub()\n}\n\nStreamCipher.prototype.getAuthTag = function getAuthTag () {\n  if (this._decrypt || !Buffer.isBuffer(this._authTag)) throw new Error('Attempting to get auth tag in unsupported state')\n\n  return this._authTag\n}\n\nStreamCipher.prototype.setAuthTag = function setAuthTag (tag) {\n  if (!this._decrypt) throw new Error('Attempting to set auth tag in unsupported state')\n\n  this._authTag = tag\n}\n\nStreamCipher.prototype.setAAD = function setAAD (buf) {\n  if (this._called) throw new Error('Attempting to set AAD in unsupported state')\n\n  this._ghash.update(buf)\n  this._alen += buf.length\n}\n\nmodule.exports = StreamCipher\n"]},"metadata":{},"sourceType":"script"}