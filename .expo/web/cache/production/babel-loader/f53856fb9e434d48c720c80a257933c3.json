{"ast":null,"code":"'use strict';var utils=require(\"../utils\");var BN=require('bn.js');var inherits=require('inherits');var Base=require(\"./base\");var assert=utils.assert;function EdwardsCurve(conf){this.twisted=(conf.a|0)!==1;this.mOneA=this.twisted&&(conf.a|0)===-1;this.extended=this.mOneA;Base.call(this,'edwards',conf);this.a=new BN(conf.a,16).umod(this.red.m);this.a=this.a.toRed(this.red);this.c=new BN(conf.c,16).toRed(this.red);this.c2=this.c.redSqr();this.d=new BN(conf.d,16).toRed(this.red);this.dd=this.d.redAdd(this.d);assert(!this.twisted||this.c.fromRed().cmpn(1)===0);this.oneC=(conf.c|0)===1;}inherits(EdwardsCurve,Base);module.exports=EdwardsCurve;EdwardsCurve.prototype._mulA=function _mulA(num){if(this.mOneA)return num.redNeg();else return this.a.redMul(num);};EdwardsCurve.prototype._mulC=function _mulC(num){if(this.oneC)return num;else return this.c.redMul(num);};EdwardsCurve.prototype.jpoint=function jpoint(x,y,z,t){return this.point(x,y,z,t);};EdwardsCurve.prototype.pointFromX=function pointFromX(x,odd){x=new BN(x,16);if(!x.red)x=x.toRed(this.red);var x2=x.redSqr();var rhs=this.c2.redSub(this.a.redMul(x2));var lhs=this.one.redSub(this.c2.redMul(this.d).redMul(x2));var y2=rhs.redMul(lhs.redInvm());var y=y2.redSqrt();if(y.redSqr().redSub(y2).cmp(this.zero)!==0)throw new Error('invalid point');var isOdd=y.fromRed().isOdd();if(odd&&!isOdd||!odd&&isOdd)y=y.redNeg();return this.point(x,y);};EdwardsCurve.prototype.pointFromY=function pointFromY(y,odd){y=new BN(y,16);if(!y.red)y=y.toRed(this.red);var y2=y.redSqr();var lhs=y2.redSub(this.c2);var rhs=y2.redMul(this.d).redMul(this.c2).redSub(this.a);var x2=lhs.redMul(rhs.redInvm());if(x2.cmp(this.zero)===0){if(odd)throw new Error('invalid point');else return this.point(this.zero,y);}var x=x2.redSqrt();if(x.redSqr().redSub(x2).cmp(this.zero)!==0)throw new Error('invalid point');if(x.fromRed().isOdd()!==odd)x=x.redNeg();return this.point(x,y);};EdwardsCurve.prototype.validate=function validate(point){if(point.isInfinity())return true;point.normalize();var x2=point.x.redSqr();var y2=point.y.redSqr();var lhs=x2.redMul(this.a).redAdd(y2);var rhs=this.c2.redMul(this.one.redAdd(this.d.redMul(x2).redMul(y2)));return lhs.cmp(rhs)===0;};function Point(curve,x,y,z,t){Base.BasePoint.call(this,curve,'projective');if(x===null&&y===null&&z===null){this.x=this.curve.zero;this.y=this.curve.one;this.z=this.curve.one;this.t=this.curve.zero;this.zOne=true;}else{this.x=new BN(x,16);this.y=new BN(y,16);this.z=z?new BN(z,16):this.curve.one;this.t=t&&new BN(t,16);if(!this.x.red)this.x=this.x.toRed(this.curve.red);if(!this.y.red)this.y=this.y.toRed(this.curve.red);if(!this.z.red)this.z=this.z.toRed(this.curve.red);if(this.t&&!this.t.red)this.t=this.t.toRed(this.curve.red);this.zOne=this.z===this.curve.one;if(this.curve.extended&&!this.t){this.t=this.x.redMul(this.y);if(!this.zOne)this.t=this.t.redMul(this.z.redInvm());}}}inherits(Point,Base.BasePoint);EdwardsCurve.prototype.pointFromJSON=function pointFromJSON(obj){return Point.fromJSON(this,obj);};EdwardsCurve.prototype.point=function point(x,y,z,t){return new Point(this,x,y,z,t);};Point.fromJSON=function fromJSON(curve,obj){return new Point(curve,obj[0],obj[1],obj[2]);};Point.prototype.inspect=function inspect(){if(this.isInfinity())return'<EC Point Infinity>';return'<EC Point x: '+this.x.fromRed().toString(16,2)+' y: '+this.y.fromRed().toString(16,2)+' z: '+this.z.fromRed().toString(16,2)+'>';};Point.prototype.isInfinity=function isInfinity(){return this.x.cmpn(0)===0&&(this.y.cmp(this.z)===0||this.zOne&&this.y.cmp(this.curve.c)===0);};Point.prototype._extDbl=function _extDbl(){var a=this.x.redSqr();var b=this.y.redSqr();var c=this.z.redSqr();c=c.redIAdd(c);var d=this.curve._mulA(a);var e=this.x.redAdd(this.y).redSqr().redISub(a).redISub(b);var g=d.redAdd(b);var f=g.redSub(c);var h=d.redSub(b);var nx=e.redMul(f);var ny=g.redMul(h);var nt=e.redMul(h);var nz=f.redMul(g);return this.curve.point(nx,ny,nz,nt);};Point.prototype._projDbl=function _projDbl(){var b=this.x.redAdd(this.y).redSqr();var c=this.x.redSqr();var d=this.y.redSqr();var nx;var ny;var nz;if(this.curve.twisted){var e=this.curve._mulA(c);var f=e.redAdd(d);if(this.zOne){nx=b.redSub(c).redSub(d).redMul(f.redSub(this.curve.two));ny=f.redMul(e.redSub(d));nz=f.redSqr().redSub(f).redSub(f);}else{var h=this.z.redSqr();var j=f.redSub(h).redISub(h);nx=b.redSub(c).redISub(d).redMul(j);ny=f.redMul(e.redSub(d));nz=f.redMul(j);}}else{var e=c.redAdd(d);var h=this.curve._mulC(this.z).redSqr();var j=e.redSub(h).redSub(h);nx=this.curve._mulC(b.redISub(e)).redMul(j);ny=this.curve._mulC(e).redMul(c.redISub(d));nz=e.redMul(j);}return this.curve.point(nx,ny,nz);};Point.prototype.dbl=function dbl(){if(this.isInfinity())return this;if(this.curve.extended)return this._extDbl();else return this._projDbl();};Point.prototype._extAdd=function _extAdd(p){var a=this.y.redSub(this.x).redMul(p.y.redSub(p.x));var b=this.y.redAdd(this.x).redMul(p.y.redAdd(p.x));var c=this.t.redMul(this.curve.dd).redMul(p.t);var d=this.z.redMul(p.z.redAdd(p.z));var e=b.redSub(a);var f=d.redSub(c);var g=d.redAdd(c);var h=b.redAdd(a);var nx=e.redMul(f);var ny=g.redMul(h);var nt=e.redMul(h);var nz=f.redMul(g);return this.curve.point(nx,ny,nz,nt);};Point.prototype._projAdd=function _projAdd(p){var a=this.z.redMul(p.z);var b=a.redSqr();var c=this.x.redMul(p.x);var d=this.y.redMul(p.y);var e=this.curve.d.redMul(c).redMul(d);var f=b.redSub(e);var g=b.redAdd(e);var tmp=this.x.redAdd(this.y).redMul(p.x.redAdd(p.y)).redISub(c).redISub(d);var nx=a.redMul(f).redMul(tmp);var ny;var nz;if(this.curve.twisted){ny=a.redMul(g).redMul(d.redSub(this.curve._mulA(c)));nz=f.redMul(g);}else{ny=a.redMul(g).redMul(d.redSub(c));nz=this.curve._mulC(f).redMul(g);}return this.curve.point(nx,ny,nz);};Point.prototype.add=function add(p){if(this.isInfinity())return p;if(p.isInfinity())return this;if(this.curve.extended)return this._extAdd(p);else return this._projAdd(p);};Point.prototype.mul=function mul(k){if(this._hasDoubles(k))return this.curve._fixedNafMul(this,k);else return this.curve._wnafMul(this,k);};Point.prototype.mulAdd=function mulAdd(k1,p,k2){return this.curve._wnafMulAdd(1,[this,p],[k1,k2],2,false);};Point.prototype.jmulAdd=function jmulAdd(k1,p,k2){return this.curve._wnafMulAdd(1,[this,p],[k1,k2],2,true);};Point.prototype.normalize=function normalize(){if(this.zOne)return this;var zi=this.z.redInvm();this.x=this.x.redMul(zi);this.y=this.y.redMul(zi);if(this.t)this.t=this.t.redMul(zi);this.z=this.curve.one;this.zOne=true;return this;};Point.prototype.neg=function neg(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg());};Point.prototype.getX=function getX(){this.normalize();return this.x.fromRed();};Point.prototype.getY=function getY(){this.normalize();return this.y.fromRed();};Point.prototype.eq=function eq(other){return this===other||this.getX().cmp(other.getX())===0&&this.getY().cmp(other.getY())===0;};Point.prototype.eqXToP=function eqXToP(x){var rx=x.toRed(this.curve.red).redMul(this.z);if(this.x.cmp(rx)===0)return true;var xc=x.clone();var t=this.curve.redN.redMul(this.z);for(;;){xc.iadd(this.curve.n);if(xc.cmp(this.curve.p)>=0)return false;rx.redIAdd(t);if(this.x.cmp(rx)===0)return true;}};Point.prototype.toP=Point.prototype.normalize;Point.prototype.mixedAdd=Point.prototype.add;","map":{"version":3,"sources":["/Users/naohirofujie/.anyenv/envs/nodenv/versions/14.5.0/lib/node_modules/expo-cli/node_modules/elliptic/lib/elliptic/curve/edwards.js"],"names":["utils","require","BN","inherits","Base","assert","EdwardsCurve","conf","twisted","a","mOneA","extended","call","umod","red","m","toRed","c","c2","redSqr","d","dd","redAdd","fromRed","cmpn","oneC","module","exports","prototype","_mulA","num","redNeg","redMul","_mulC","jpoint","x","y","z","t","point","pointFromX","odd","x2","rhs","redSub","lhs","one","y2","redInvm","redSqrt","cmp","zero","Error","isOdd","pointFromY","validate","isInfinity","normalize","Point","curve","BasePoint","zOne","pointFromJSON","obj","fromJSON","inspect","toString","_extDbl","b","redIAdd","e","redISub","g","f","h","nx","ny","nt","nz","_projDbl","two","j","dbl","_extAdd","p","_projAdd","tmp","add","mul","k","_hasDoubles","_fixedNafMul","_wnafMul","mulAdd","k1","k2","_wnafMulAdd","jmulAdd","zi","neg","getX","getY","eq","other","eqXToP","rx","xc","clone","redN","iadd","n","toP","mixedAdd"],"mappings":"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","sourcesContent":["'use strict';\n\nvar utils = require('../utils');\nvar BN = require('bn.js');\nvar inherits = require('inherits');\nvar Base = require('./base');\n\nvar assert = utils.assert;\n\nfunction EdwardsCurve(conf) {\n  // NOTE: Important as we are creating point in Base.call()\n  this.twisted = (conf.a | 0) !== 1;\n  this.mOneA = this.twisted && (conf.a | 0) === -1;\n  this.extended = this.mOneA;\n\n  Base.call(this, 'edwards', conf);\n\n  this.a = new BN(conf.a, 16).umod(this.red.m);\n  this.a = this.a.toRed(this.red);\n  this.c = new BN(conf.c, 16).toRed(this.red);\n  this.c2 = this.c.redSqr();\n  this.d = new BN(conf.d, 16).toRed(this.red);\n  this.dd = this.d.redAdd(this.d);\n\n  assert(!this.twisted || this.c.fromRed().cmpn(1) === 0);\n  this.oneC = (conf.c | 0) === 1;\n}\ninherits(EdwardsCurve, Base);\nmodule.exports = EdwardsCurve;\n\nEdwardsCurve.prototype._mulA = function _mulA(num) {\n  if (this.mOneA)\n    return num.redNeg();\n  else\n    return this.a.redMul(num);\n};\n\nEdwardsCurve.prototype._mulC = function _mulC(num) {\n  if (this.oneC)\n    return num;\n  else\n    return this.c.redMul(num);\n};\n\n// Just for compatibility with Short curve\nEdwardsCurve.prototype.jpoint = function jpoint(x, y, z, t) {\n  return this.point(x, y, z, t);\n};\n\nEdwardsCurve.prototype.pointFromX = function pointFromX(x, odd) {\n  x = new BN(x, 16);\n  if (!x.red)\n    x = x.toRed(this.red);\n\n  var x2 = x.redSqr();\n  var rhs = this.c2.redSub(this.a.redMul(x2));\n  var lhs = this.one.redSub(this.c2.redMul(this.d).redMul(x2));\n\n  var y2 = rhs.redMul(lhs.redInvm());\n  var y = y2.redSqrt();\n  if (y.redSqr().redSub(y2).cmp(this.zero) !== 0)\n    throw new Error('invalid point');\n\n  var isOdd = y.fromRed().isOdd();\n  if (odd && !isOdd || !odd && isOdd)\n    y = y.redNeg();\n\n  return this.point(x, y);\n};\n\nEdwardsCurve.prototype.pointFromY = function pointFromY(y, odd) {\n  y = new BN(y, 16);\n  if (!y.red)\n    y = y.toRed(this.red);\n\n  // x^2 = (y^2 - c^2) / (c^2 d y^2 - a)\n  var y2 = y.redSqr();\n  var lhs = y2.redSub(this.c2);\n  var rhs = y2.redMul(this.d).redMul(this.c2).redSub(this.a);\n  var x2 = lhs.redMul(rhs.redInvm());\n\n  if (x2.cmp(this.zero) === 0) {\n    if (odd)\n      throw new Error('invalid point');\n    else\n      return this.point(this.zero, y);\n  }\n\n  var x = x2.redSqrt();\n  if (x.redSqr().redSub(x2).cmp(this.zero) !== 0)\n    throw new Error('invalid point');\n\n  if (x.fromRed().isOdd() !== odd)\n    x = x.redNeg();\n\n  return this.point(x, y);\n};\n\nEdwardsCurve.prototype.validate = function validate(point) {\n  if (point.isInfinity())\n    return true;\n\n  // Curve: A * X^2 + Y^2 = C^2 * (1 + D * X^2 * Y^2)\n  point.normalize();\n\n  var x2 = point.x.redSqr();\n  var y2 = point.y.redSqr();\n  var lhs = x2.redMul(this.a).redAdd(y2);\n  var rhs = this.c2.redMul(this.one.redAdd(this.d.redMul(x2).redMul(y2)));\n\n  return lhs.cmp(rhs) === 0;\n};\n\nfunction Point(curve, x, y, z, t) {\n  Base.BasePoint.call(this, curve, 'projective');\n  if (x === null && y === null && z === null) {\n    this.x = this.curve.zero;\n    this.y = this.curve.one;\n    this.z = this.curve.one;\n    this.t = this.curve.zero;\n    this.zOne = true;\n  } else {\n    this.x = new BN(x, 16);\n    this.y = new BN(y, 16);\n    this.z = z ? new BN(z, 16) : this.curve.one;\n    this.t = t && new BN(t, 16);\n    if (!this.x.red)\n      this.x = this.x.toRed(this.curve.red);\n    if (!this.y.red)\n      this.y = this.y.toRed(this.curve.red);\n    if (!this.z.red)\n      this.z = this.z.toRed(this.curve.red);\n    if (this.t && !this.t.red)\n      this.t = this.t.toRed(this.curve.red);\n    this.zOne = this.z === this.curve.one;\n\n    // Use extended coordinates\n    if (this.curve.extended && !this.t) {\n      this.t = this.x.redMul(this.y);\n      if (!this.zOne)\n        this.t = this.t.redMul(this.z.redInvm());\n    }\n  }\n}\ninherits(Point, Base.BasePoint);\n\nEdwardsCurve.prototype.pointFromJSON = function pointFromJSON(obj) {\n  return Point.fromJSON(this, obj);\n};\n\nEdwardsCurve.prototype.point = function point(x, y, z, t) {\n  return new Point(this, x, y, z, t);\n};\n\nPoint.fromJSON = function fromJSON(curve, obj) {\n  return new Point(curve, obj[0], obj[1], obj[2]);\n};\n\nPoint.prototype.inspect = function inspect() {\n  if (this.isInfinity())\n    return '<EC Point Infinity>';\n  return '<EC Point x: ' + this.x.fromRed().toString(16, 2) +\n      ' y: ' + this.y.fromRed().toString(16, 2) +\n      ' z: ' + this.z.fromRed().toString(16, 2) + '>';\n};\n\nPoint.prototype.isInfinity = function isInfinity() {\n  // XXX This code assumes that zero is always zero in red\n  return this.x.cmpn(0) === 0 &&\n    (this.y.cmp(this.z) === 0 ||\n    (this.zOne && this.y.cmp(this.curve.c) === 0));\n};\n\nPoint.prototype._extDbl = function _extDbl() {\n  // hyperelliptic.org/EFD/g1p/auto-twisted-extended-1.html\n  //     #doubling-dbl-2008-hwcd\n  // 4M + 4S\n\n  // A = X1^2\n  var a = this.x.redSqr();\n  // B = Y1^2\n  var b = this.y.redSqr();\n  // C = 2 * Z1^2\n  var c = this.z.redSqr();\n  c = c.redIAdd(c);\n  // D = a * A\n  var d = this.curve._mulA(a);\n  // E = (X1 + Y1)^2 - A - B\n  var e = this.x.redAdd(this.y).redSqr().redISub(a).redISub(b);\n  // G = D + B\n  var g = d.redAdd(b);\n  // F = G - C\n  var f = g.redSub(c);\n  // H = D - B\n  var h = d.redSub(b);\n  // X3 = E * F\n  var nx = e.redMul(f);\n  // Y3 = G * H\n  var ny = g.redMul(h);\n  // T3 = E * H\n  var nt = e.redMul(h);\n  // Z3 = F * G\n  var nz = f.redMul(g);\n  return this.curve.point(nx, ny, nz, nt);\n};\n\nPoint.prototype._projDbl = function _projDbl() {\n  // hyperelliptic.org/EFD/g1p/auto-twisted-projective.html\n  //     #doubling-dbl-2008-bbjlp\n  //     #doubling-dbl-2007-bl\n  // and others\n  // Generally 3M + 4S or 2M + 4S\n\n  // B = (X1 + Y1)^2\n  var b = this.x.redAdd(this.y).redSqr();\n  // C = X1^2\n  var c = this.x.redSqr();\n  // D = Y1^2\n  var d = this.y.redSqr();\n\n  var nx;\n  var ny;\n  var nz;\n  if (this.curve.twisted) {\n    // E = a * C\n    var e = this.curve._mulA(c);\n    // F = E + D\n    var f = e.redAdd(d);\n    if (this.zOne) {\n      // X3 = (B - C - D) * (F - 2)\n      nx = b.redSub(c).redSub(d).redMul(f.redSub(this.curve.two));\n      // Y3 = F * (E - D)\n      ny = f.redMul(e.redSub(d));\n      // Z3 = F^2 - 2 * F\n      nz = f.redSqr().redSub(f).redSub(f);\n    } else {\n      // H = Z1^2\n      var h = this.z.redSqr();\n      // J = F - 2 * H\n      var j = f.redSub(h).redISub(h);\n      // X3 = (B-C-D)*J\n      nx = b.redSub(c).redISub(d).redMul(j);\n      // Y3 = F * (E - D)\n      ny = f.redMul(e.redSub(d));\n      // Z3 = F * J\n      nz = f.redMul(j);\n    }\n  } else {\n    // E = C + D\n    var e = c.redAdd(d);\n    // H = (c * Z1)^2\n    var h = this.curve._mulC(this.z).redSqr();\n    // J = E - 2 * H\n    var j = e.redSub(h).redSub(h);\n    // X3 = c * (B - E) * J\n    nx = this.curve._mulC(b.redISub(e)).redMul(j);\n    // Y3 = c * E * (C - D)\n    ny = this.curve._mulC(e).redMul(c.redISub(d));\n    // Z3 = E * J\n    nz = e.redMul(j);\n  }\n  return this.curve.point(nx, ny, nz);\n};\n\nPoint.prototype.dbl = function dbl() {\n  if (this.isInfinity())\n    return this;\n\n  // Double in extended coordinates\n  if (this.curve.extended)\n    return this._extDbl();\n  else\n    return this._projDbl();\n};\n\nPoint.prototype._extAdd = function _extAdd(p) {\n  // hyperelliptic.org/EFD/g1p/auto-twisted-extended-1.html\n  //     #addition-add-2008-hwcd-3\n  // 8M\n\n  // A = (Y1 - X1) * (Y2 - X2)\n  var a = this.y.redSub(this.x).redMul(p.y.redSub(p.x));\n  // B = (Y1 + X1) * (Y2 + X2)\n  var b = this.y.redAdd(this.x).redMul(p.y.redAdd(p.x));\n  // C = T1 * k * T2\n  var c = this.t.redMul(this.curve.dd).redMul(p.t);\n  // D = Z1 * 2 * Z2\n  var d = this.z.redMul(p.z.redAdd(p.z));\n  // E = B - A\n  var e = b.redSub(a);\n  // F = D - C\n  var f = d.redSub(c);\n  // G = D + C\n  var g = d.redAdd(c);\n  // H = B + A\n  var h = b.redAdd(a);\n  // X3 = E * F\n  var nx = e.redMul(f);\n  // Y3 = G * H\n  var ny = g.redMul(h);\n  // T3 = E * H\n  var nt = e.redMul(h);\n  // Z3 = F * G\n  var nz = f.redMul(g);\n  return this.curve.point(nx, ny, nz, nt);\n};\n\nPoint.prototype._projAdd = function _projAdd(p) {\n  // hyperelliptic.org/EFD/g1p/auto-twisted-projective.html\n  //     #addition-add-2008-bbjlp\n  //     #addition-add-2007-bl\n  // 10M + 1S\n\n  // A = Z1 * Z2\n  var a = this.z.redMul(p.z);\n  // B = A^2\n  var b = a.redSqr();\n  // C = X1 * X2\n  var c = this.x.redMul(p.x);\n  // D = Y1 * Y2\n  var d = this.y.redMul(p.y);\n  // E = d * C * D\n  var e = this.curve.d.redMul(c).redMul(d);\n  // F = B - E\n  var f = b.redSub(e);\n  // G = B + E\n  var g = b.redAdd(e);\n  // X3 = A * F * ((X1 + Y1) * (X2 + Y2) - C - D)\n  var tmp = this.x.redAdd(this.y).redMul(p.x.redAdd(p.y)).redISub(c).redISub(d);\n  var nx = a.redMul(f).redMul(tmp);\n  var ny;\n  var nz;\n  if (this.curve.twisted) {\n    // Y3 = A * G * (D - a * C)\n    ny = a.redMul(g).redMul(d.redSub(this.curve._mulA(c)));\n    // Z3 = F * G\n    nz = f.redMul(g);\n  } else {\n    // Y3 = A * G * (D - C)\n    ny = a.redMul(g).redMul(d.redSub(c));\n    // Z3 = c * F * G\n    nz = this.curve._mulC(f).redMul(g);\n  }\n  return this.curve.point(nx, ny, nz);\n};\n\nPoint.prototype.add = function add(p) {\n  if (this.isInfinity())\n    return p;\n  if (p.isInfinity())\n    return this;\n\n  if (this.curve.extended)\n    return this._extAdd(p);\n  else\n    return this._projAdd(p);\n};\n\nPoint.prototype.mul = function mul(k) {\n  if (this._hasDoubles(k))\n    return this.curve._fixedNafMul(this, k);\n  else\n    return this.curve._wnafMul(this, k);\n};\n\nPoint.prototype.mulAdd = function mulAdd(k1, p, k2) {\n  return this.curve._wnafMulAdd(1, [ this, p ], [ k1, k2 ], 2, false);\n};\n\nPoint.prototype.jmulAdd = function jmulAdd(k1, p, k2) {\n  return this.curve._wnafMulAdd(1, [ this, p ], [ k1, k2 ], 2, true);\n};\n\nPoint.prototype.normalize = function normalize() {\n  if (this.zOne)\n    return this;\n\n  // Normalize coordinates\n  var zi = this.z.redInvm();\n  this.x = this.x.redMul(zi);\n  this.y = this.y.redMul(zi);\n  if (this.t)\n    this.t = this.t.redMul(zi);\n  this.z = this.curve.one;\n  this.zOne = true;\n  return this;\n};\n\nPoint.prototype.neg = function neg() {\n  return this.curve.point(this.x.redNeg(),\n                          this.y,\n                          this.z,\n                          this.t && this.t.redNeg());\n};\n\nPoint.prototype.getX = function getX() {\n  this.normalize();\n  return this.x.fromRed();\n};\n\nPoint.prototype.getY = function getY() {\n  this.normalize();\n  return this.y.fromRed();\n};\n\nPoint.prototype.eq = function eq(other) {\n  return this === other ||\n         this.getX().cmp(other.getX()) === 0 &&\n         this.getY().cmp(other.getY()) === 0;\n};\n\nPoint.prototype.eqXToP = function eqXToP(x) {\n  var rx = x.toRed(this.curve.red).redMul(this.z);\n  if (this.x.cmp(rx) === 0)\n    return true;\n\n  var xc = x.clone();\n  var t = this.curve.redN.redMul(this.z);\n  for (;;) {\n    xc.iadd(this.curve.n);\n    if (xc.cmp(this.curve.p) >= 0)\n      return false;\n\n    rx.redIAdd(t);\n    if (this.x.cmp(rx) === 0)\n      return true;\n  }\n};\n\n// Compatibility with BaseCurve\nPoint.prototype.toP = Point.prototype.normalize;\nPoint.prototype.mixedAdd = Point.prototype.add;\n"]},"metadata":{},"sourceType":"script"}