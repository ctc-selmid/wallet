{"ast":null,"code":"var parseKeys=require('parse-asn1');var mgf=require(\"./mgf\");var xor=require(\"./xor\");var BN=require('bn.js');var crt=require('browserify-rsa');var createHash=require('create-hash');var withPublic=require(\"./withPublic\");var Buffer=require('safe-buffer').Buffer;module.exports=function privateDecrypt(privateKey,enc,reverse){var padding;if(privateKey.padding){padding=privateKey.padding;}else if(reverse){padding=1;}else{padding=4;}var key=parseKeys(privateKey);var k=key.modulus.byteLength();if(enc.length>k||new BN(enc).cmp(key.modulus)>=0){throw new Error('decryption error');}var msg;if(reverse){msg=withPublic(new BN(enc),key);}else{msg=crt(enc,key);}var zBuffer=Buffer.alloc(k-msg.length);msg=Buffer.concat([zBuffer,msg],k);if(padding===4){return oaep(key,msg);}else if(padding===1){return pkcs1(key,msg,reverse);}else if(padding===3){return msg;}else{throw new Error('unknown padding');}};function oaep(key,msg){var k=key.modulus.byteLength();var iHash=createHash('sha1').update(Buffer.alloc(0)).digest();var hLen=iHash.length;if(msg[0]!==0){throw new Error('decryption error');}var maskedSeed=msg.slice(1,hLen+1);var maskedDb=msg.slice(hLen+1);var seed=xor(maskedSeed,mgf(maskedDb,hLen));var db=xor(maskedDb,mgf(seed,k-hLen-1));if(compare(iHash,db.slice(0,hLen))){throw new Error('decryption error');}var i=hLen;while(db[i]===0){i++;}if(db[i++]!==1){throw new Error('decryption error');}return db.slice(i);}function pkcs1(key,msg,reverse){var p1=msg.slice(0,2);var i=2;var status=0;while(msg[i++]!==0){if(i>=msg.length){status++;break;}}var ps=msg.slice(2,i-1);if(p1.toString('hex')!=='0002'&&!reverse||p1.toString('hex')!=='0001'&&reverse){status++;}if(ps.length<8){status++;}if(status){throw new Error('decryption error');}return msg.slice(i);}function compare(a,b){a=Buffer.from(a);b=Buffer.from(b);var dif=0;var len=a.length;if(a.length!==b.length){dif++;len=Math.min(a.length,b.length);}var i=-1;while(++i<len){dif+=a[i]^b[i];}return dif;}","map":{"version":3,"sources":["/Users/naohirofujie/.anyenv/envs/nodenv/versions/14.5.0/lib/node_modules/expo-cli/node_modules/public-encrypt/privateDecrypt.js"],"names":["parseKeys","require","mgf","xor","BN","crt","createHash","withPublic","Buffer","module","exports","privateDecrypt","privateKey","enc","reverse","padding","key","k","modulus","byteLength","length","cmp","Error","msg","zBuffer","alloc","concat","oaep","pkcs1","iHash","update","digest","hLen","maskedSeed","slice","maskedDb","seed","db","compare","i","p1","status","ps","toString","a","b","from","dif","len","Math","min"],"mappings":"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","sourcesContent":["var parseKeys = require('parse-asn1')\nvar mgf = require('./mgf')\nvar xor = require('./xor')\nvar BN = require('bn.js')\nvar crt = require('browserify-rsa')\nvar createHash = require('create-hash')\nvar withPublic = require('./withPublic')\nvar Buffer = require('safe-buffer').Buffer\n\nmodule.exports = function privateDecrypt (privateKey, enc, reverse) {\n  var padding\n  if (privateKey.padding) {\n    padding = privateKey.padding\n  } else if (reverse) {\n    padding = 1\n  } else {\n    padding = 4\n  }\n\n  var key = parseKeys(privateKey)\n  var k = key.modulus.byteLength()\n  if (enc.length > k || new BN(enc).cmp(key.modulus) >= 0) {\n    throw new Error('decryption error')\n  }\n  var msg\n  if (reverse) {\n    msg = withPublic(new BN(enc), key)\n  } else {\n    msg = crt(enc, key)\n  }\n  var zBuffer = Buffer.alloc(k - msg.length)\n  msg = Buffer.concat([zBuffer, msg], k)\n  if (padding === 4) {\n    return oaep(key, msg)\n  } else if (padding === 1) {\n    return pkcs1(key, msg, reverse)\n  } else if (padding === 3) {\n    return msg\n  } else {\n    throw new Error('unknown padding')\n  }\n}\n\nfunction oaep (key, msg) {\n  var k = key.modulus.byteLength()\n  var iHash = createHash('sha1').update(Buffer.alloc(0)).digest()\n  var hLen = iHash.length\n  if (msg[0] !== 0) {\n    throw new Error('decryption error')\n  }\n  var maskedSeed = msg.slice(1, hLen + 1)\n  var maskedDb = msg.slice(hLen + 1)\n  var seed = xor(maskedSeed, mgf(maskedDb, hLen))\n  var db = xor(maskedDb, mgf(seed, k - hLen - 1))\n  if (compare(iHash, db.slice(0, hLen))) {\n    throw new Error('decryption error')\n  }\n  var i = hLen\n  while (db[i] === 0) {\n    i++\n  }\n  if (db[i++] !== 1) {\n    throw new Error('decryption error')\n  }\n  return db.slice(i)\n}\n\nfunction pkcs1 (key, msg, reverse) {\n  var p1 = msg.slice(0, 2)\n  var i = 2\n  var status = 0\n  while (msg[i++] !== 0) {\n    if (i >= msg.length) {\n      status++\n      break\n    }\n  }\n  var ps = msg.slice(2, i - 1)\n\n  if ((p1.toString('hex') !== '0002' && !reverse) || (p1.toString('hex') !== '0001' && reverse)) {\n    status++\n  }\n  if (ps.length < 8) {\n    status++\n  }\n  if (status) {\n    throw new Error('decryption error')\n  }\n  return msg.slice(i)\n}\nfunction compare (a, b) {\n  a = Buffer.from(a)\n  b = Buffer.from(b)\n  var dif = 0\n  var len = a.length\n  if (a.length !== b.length) {\n    dif++\n    len = Math.min(a.length, b.length)\n  }\n  var i = -1\n  while (++i < len) {\n    dif += (a[i] ^ b[i])\n  }\n  return dif\n}\n"]},"metadata":{},"sourceType":"script"}